<h4 mat-dialog-title class="title-subsection">{{title}}</h4>
<ngx-spinner></ngx-spinner>
<mat-divider></mat-divider>
<br>

<mat-dialog-content class="mat-typography" [formGroup]="taskForm">
  <mat-card>

    <mat-card-content>

      <div fxLayout="row" fxLayoutGap="40px" fxLayout.xs="column">

        <div class="container" fxFlex="100" fxLayout="column" fxLayout.xs="column">

          <div fxLayout="row"
               fxLayout.xs="column"
               fxLayout.sm="column"
               fxLayoutGap="20px">
            <mat-form-field fxFlex="100">
              <mat-label>Tarea</mat-label>
              <input
                matInput
                type="text"
                formControlName="title">
              <mat-error *ngIf="fieldInvalid('title')">
                Favor de Ingresar la Tarea
              </mat-error>
            </mat-form-field>

            <mat-form-field fxFlex="100">
              <mat-label>Empleados</mat-label>
              <mat-select
                formControlName="employee_id">
                <mat-option *ngFor="let employee of employees" [value]="employee.id">
                  {{ employee.name }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="fieldInvalid('employee_id')">
                Favor de Seleccionar un Empleado
              </mat-error>
            </mat-form-field>

          </div>

          <div fxLayout="row"
               fxLayout.xs="column"
               fxLayout.sm="column"
               fxLayoutGap="20px">

            <mat-form-field fxFlex="100">
              <mat-label>Grupos</mat-label>
              <mat-select
                formControlName="job_center_id">
                <mat-option *ngFor="let jobCenter of jobCenters" [value]="jobCenter.id">
                  {{ jobCenter.name}}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="fieldInvalid('job_center_id')">
                Favor de Seleccionar un Grupo
              </mat-error>
            </mat-form-field>

            <mat-form-field fxFlex="100">
              <mat-label>Clientes</mat-label>
              <mat-select
                (selectionChange)="selectCustomer($event.value)"
                formControlName="customer_id">
                <mat-option *ngFor="let customer of customers" [value]="customer.id">
                  {{ customer.name}}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="fieldInvalid('customer_id')">
                Favor de Seleccionar un Cliente
              </mat-error>
            </mat-form-field>

          </div>

          <div fxLayout="row"
               fxLayout.xs="column"
               fxLayout.sm="column"
               fxLayoutGap="20px">

            <mat-form-field fxFlex="100">
              <mat-label>Accesos Cliente</mat-label>
              <mat-select multiple formControlName="doors" [compareWith]="setValueSelectObjectMultiple">
                <mat-option *ngFor="let doorType of doorTypes" [value]="doorType.id">
                  {{ doorType.name }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="fieldInvalid('doors')">
                Favor de Seleccionar una o mas Accesos
              </mat-error>
            </mat-form-field>

            <mat-form-field fxFlex="100">
              <mat-label>Tipos de Trabajos</mat-label>
              <mat-select formControlName="work_type_id">
                <mat-option *ngFor="let workType of workTypes" [value]="workType.id">
                  {{ workType.name }}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="fieldInvalid('work_type_id')">
                Favor de Seleccionar un Tipo Trabajo
              </mat-error>
            </mat-form-field>


          </div>

          <div fxLayout="row"
               fxLayout.xs="column"
               fxLayout.sm="column"
               fxLayoutGap="20px">

            <mat-form-field fxFlex="100">
              <mat-label>Comentarios</mat-label>
              <input
                matInput
                type="text"
                formControlName="comments"
              >
            </mat-form-field>

          </div>

          <div fxLayout="row"
               fxLayout.xs="column"
               fxLayout.sm="column"
               fxLayoutGap="10px">

            <mat-form-field fxFlex="50">
                <mat-label>Enter a date range</mat-label>
                <mat-date-range-input  [rangePicker]="picker">
                  <input matStartDate formControlName="initial_date" placeholder="Fecha Inicial">
                  <input matEndDate formControlName="final_date" placeholder="Fecha Final">
                </mat-date-range-input>
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-date-range-picker #picker></mat-date-range-picker>

                <mat-error>fecha No ingresada correctamente.</mat-error>
              </mat-form-field>

            <mat-form-field fxFlex="25">
              <mat-label>Hora Inicial</mat-label>
              <input
                matInput
                type="time"
                formControlName="initial_hour">
              <mat-error *ngIf="fieldInvalid('initial_hour')">
                Favor de Ingresar la Hora Inicial
              </mat-error>
            </mat-form-field>

            <mat-form-field fxFlex="25">
              <mat-label>Hora Final</mat-label>
              <input
                matInput
                type="time"
                formControlName="final_hour">
              <mat-error *ngIf="fieldInvalid('final_hour')">
                Favor de Ingresar la Hora Final
              </mat-error>
            </mat-form-field>

          </div>

        </div>

      </div>

    </mat-card-content>
  </mat-card>

  <div *ngIf="task.info">
    <div fxLayout="row">
      <div fxFlex="100">
        <mat-form-field appearance="standard">
          <mat-label>Filtrar Puertas</mat-label>
          <input matInput (keyup)="applyFilter($event)" placeholder="Buscar en Tabla Puertas" #input>
        </mat-form-field>
      </div>
    </div>

    <!--Tabla Accesos-->
    <div class="mat-elevation-z8">
      <table mat-table [dataSource]="dataSource" matSort >

        <!-- ID Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header=""> ID</th>
          <td mat-cell *matCellDef="let row"> {{row.id}} </td>
        </ng-container>

        <!-- Folio Column -->
        <ng-container matColumnDef="folio">
          <th mat-header-cell *matHeaderCellDef mat-sort-header=""> Folio</th>
          <td mat-cell *matCellDef="let row"> {{row.folio}} </td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header=""> Nombre</th>
          <td mat-cell *matCellDef="let row"> {{row.name}} </td>
        </ng-container>

        <!-- Folio Column -->
        <ng-container matColumnDef="door_type_name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header=""> Tipo Puerta</th>
          <td mat-cell *matCellDef="let row"> {{row.door_type_name}} </td>
        </ng-container>

        <!-- TelÃ©fono Column -->
        <ng-container matColumnDef="options">
          <th mat-header-cell *matHeaderCellDef mat-sort-header=""> Links</th>
          <td mat-cell *matCellDef="let row">
            <button color="warn" mat-button (click)="viewPdf(row.report_pdf)">
              <mat-icon>picture_as_pdf</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="4">No hay datos que mostrar "{{input.value}}"</td>
        </tr>
      </table>
<!--
      <mat-paginator #paginator
                     [length]="totalItems"
                     (page)="getDoorsPaginator($event)"
                     [pageSize]="pageSize"
                     [showFirstLastButtons]="true">
      </mat-paginator>-->
    </div>
  </div>

</mat-dialog-content>

<mat-dialog-actions fxLayoutAlign="end">
  <button (click)="close()" mat-stroked-button color="primary" mat-dialog-close="true">Cancelar</button>
  <button *ngIf="!task.idTask" (click)="addTask()" mat-flat-button color="primary" cdkFocusInitial >Guardar Tarea</button>
  <button *ngIf="task.idTask && task.edit" (click)="updateTask()" mat-flat-button color="primary" cdkFocusInitial>Editar</button>
</mat-dialog-actions>


