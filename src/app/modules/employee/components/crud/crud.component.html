<h4 mat-dialog-title class="title-subsection">{{title}}</h4>
<ngx-spinner></ngx-spinner>
<mat-divider></mat-divider>
<br>
<mat-dialog-content class="mat-typography" [formGroup]="employeeForm">

<mat-card>
  <mat-card-content>

      <div fxLayout="row" fxLayoutGap="40px" fxLayout.xs="column">

        <div class="container" fxFlex="100" fxLayout="column" fxLayout.xs="column">

          <div fxLayout="row"
               fxLayout.xs="column"
               fxLayoutGap="20px">
            <mat-form-field fxFlex="35">
              <mat-label>Empleado</mat-label>
              <input
                matInput
                type="text"
                formControlName="name">
              <mat-error *ngIf="fieldInvalid('name')">
                Favor de Ingresar el Empleado
              </mat-error>
            </mat-form-field>

            <mat-form-field fxFlex="35">
              <mat-label>Correo</mat-label>
              <input
                matInput
                type="text"
                formControlName="email">
              <mat-error *ngIf="fieldInvalid('email')">
                Favor de ingresar correo correctamente
              </mat-error>
            </mat-form-field>

            <mat-form-field fxFlex="20">
              <mat-label>Color</mat-label>
              <input
                matInput
                type="color"
                formControlName="color"
              >
              <mat-error *ngIf="fieldInvalid('color')">
                Favor de elegir un color
              </mat-error>
            </mat-form-field>

          </div>

          <div fxLayout="row"
               fxLayout.xs="column"
               fxLayoutGap="20px">

            <mat-form-field fxFlex="100">
              <mat-label>Grupo</mat-label>
              <mat-select
                formControlName="job_center_id">
                <mat-option *ngFor="let jobCenter of jobCenters" [value]="jobCenter.id">
                  {{ jobCenter.name}}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="fieldInvalid('job_center_id')">
                Favor de Seleccionar un Grupo
              </mat-error>
            </mat-form-field>

            <mat-form-field fxFlex="100">
              <mat-label>Puesto</mat-label>
              <mat-select
                formControlName="job_title_id">
                <mat-option *ngFor="let job of jobs" [value]="job.id">
                  {{ job.name}}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="fieldInvalid('job_title_id')">
                Favor de Seleccionar un Puesto
              </mat-error>
            </mat-form-field>

          </div>

          <div fxLayout="row"
               fxLayout.xs="column"
               fxLayoutGap="20px">

            <ng-select fxFlex="100"
                       bindLabel="description"
                       placeholder="Permisos"
                       formControlName="permissions_user"
                       [multiple]="true"
                       appendTo="body"
                       [searchable]="true"
                       [clearable]="true"
                       bindValue="id"
                       [compareWith]="setValueSelectObjectMultiple">
              <ng-option *ngFor="let permission of permissions" [value]="permission.id">
                {{permission.description}}
              </ng-option>
            </ng-select>
            <mat-error *ngIf="fieldInvalid('permissions_user')">
              *
            </mat-error>

            <ng-select fxFlex="100"
                       bindLabel="description"
                       placeholder="Herramientas"
                       formControlName="products_employee"
                       [multiple]="true"
                       appendTo="body"
                       [searchable]="true"
                       [clearable]="true"
                       bindValue="id"
                       [compareWith]="setValueSelectObjectMultiple">
              <ng-option *ngFor="let product of products" [value]="product.id">
                {{product.description}}
              </ng-option>
            </ng-select>

          </div>

        </div>

      </div>

  </mat-card-content>
</mat-card>

  <div>
    <div fxLayout="row">

      <div fxFlex="50">
        <mat-form-field appearance="standard">
          <mat-label>Filtrar Datos Herramientas</mat-label>
          <input matInput (keyup)="applyFilter($event)" placeholder="Buscar en Tabla Herramientas" #input>
        </mat-form-field>
      </div>
      <div fxFlex="50" fxLayoutAlign="center center">
        <button (click)="openDialogTool(false, null, false, employee.idEmployee)" mat-button color="primary">
          <mat-icon>tool</mat-icon>
          Nueva Herramienta
        </button>
      </div>

    </div>

    <!--Tabla Accesos-->
    <div class="mat-elevation-z8">
      <table mat-table [dataSource]="dataSource" matSort>

        <!-- ID Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header=""> ID</th>
          <td mat-cell *matCellDef="let row"> {{row.id}} </td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header=""> Nombre</th>
          <td mat-cell *matCellDef="let row"> {{row.name}} </td>
        </ng-container>

        <!-- Description Column -->
        <ng-container matColumnDef="description">
          <th mat-header-cell *matHeaderCellDef mat-sort-header=""> Descripción</th>
          <td mat-cell *matCellDef="let row"> {{row.name}} </td>
        </ng-container>

        <!-- Brand Column -->
        <ng-container matColumnDef="brand">
          <th mat-header-cell *matHeaderCellDef mat-sort-header=""> Marca</th>
          <td mat-cell *matCellDef="let row"> {{row.brand}} </td>
        </ng-container>

        <!-- Cost Column -->
        <ng-container matColumnDef="cost">
          <th mat-header-cell *matHeaderCellDef mat-sort-header=""> Costo</th>
          <td mat-cell *matCellDef="let row"> {{row.cost}} </td>
        </ng-container>

        <!-- Teléfono Column -->
        <ng-container matColumnDef="options">
          <th mat-header-cell *matHeaderCellDef mat-sort-header=""> Opciones</th>
          <td mat-cell *matCellDef="let row">
            <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="openDialogTool(false, row.id, true, employee.idEmployee)">
              <mat-icon color="info">visibility</mat-icon>
              Ver
            </button>
            <button mat-menu-item (click)="openDialogTool(true, row.id, false, employee.idEmployee)">
              <mat-icon color="primary">edit</mat-icon>
              Editar
            </button>
            <button mat-menu-item
                    (click)="deleteTool(row)">
              <mat-icon color="warn">delete</mat-icon>
              Eliminar
            </button>
            </mat-menu>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="4">No hay datos que mostrar "{{input.value}}"</td>
        </tr>
      </table>
      <!--
            <mat-paginator #paginator
                           [length]="totalItems"
                           (page)="getDoorsPaginator($event)"
                           [pageSize]="pageSize"
                           [showFirstLastButtons]="true">
            </mat-paginator>-->
    </div>
  </div>

</mat-dialog-content>

<mat-dialog-actions fxLayoutAlign="end">
  <button (click)="close()" mat-stroked-button color="primary" mat-dialog-close="true">Cancelar</button>
  <button *ngIf="!employee.idEmployee" (click)="addEmployee()" mat-flat-button color="primary" cdkFocusInitial [disabled]="employeeForm.invalid">Guardar Empleado</button>
  <button *ngIf="employee.idEmployee && employee.edit" (click)="updateEmployee()" mat-flat-button color="primary" cdkFocusInitial>Editar</button>
</mat-dialog-actions>
